 {% extends 'base.html' %}

{% load app_filters %}

{% load staticfiles %}

{% block page_title %} Dashboard {% endblock %}

{% block style_code %}
<link href="{% static 'css/bootstrap-table.min.css' %}" rel="stylesheet" />
{% endblock %}

{% block javascript_code%}
{% endblock javascript_code%}

{% block primary %}
<!-- begin breadcrumb -->
<ol class="breadcrumb pull-right">
    <li><a href="#">Home</a></li>
    <li class="active">Forms</li>
</ol>
<!-- end breadcrumb -->

{% if messages %}
<div id="messages" class="alert alert-success fade in">
    <span class="close" data-dismiss="alert">×</span>
    <i class="fa fa-check fa-2x pull-left"></i>
    <ul class="messages">
        {% for message in messages %}
        <li{% if message.info %} class="{{ message.info }}"{% endif %}><b>{{ message }}</b></li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- begin page-header -->
<h1 class="page-header">Forms <small>Search Child</small></h1>
<!-- end page-header -->
<div id="messages" class="alert alert-danger fade in" style="display: none;" tabindex="1">
    <span class="close" data-dismiss="alert">×</span>
    <i class="fa fa-check fa-2x pull-left"></i>
    <p class="invalid-form-message"></p>
</div>

<!-- Search Row -->
<div class="row">
<!-- begin col-12 -->
<div class="col-md-12">
        <!-- begin panel -->
        <div class="panel panel-inverse">
            <div class="panel-heading">
                <div class="panel-heading-btn">
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                        <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                </div>                          
                <h4 class="panel-title"><b>Search Child</b></h4>
            </div>
            <div class="panel-body">
                <form class="form-inline" action="{% url 'ovc_search' %}" method="POST" data-parsley-validate="true">
                    {% csrf_token %}
                    <div class="form-group">
                        <b>{{ form.search_name }}</b>
                    </div>
                    <div class="form-group">
                        <b>{{ form.search_criteria }}</b>
                    </div>
                    <button type="submit" class="btn btn-sm btn-primary m-r-5">
                        <i class="fa fa-search"></i>&nbsp<b>Search</b>
                    </button>
                </form>        
            </div>
        </div>

        <!-- OVC Results Row -->
        <div class="row">
        <!-- begin col-12 -->
        <div class="col-md-12">
                <!-- begin panel -->
                <div class="panel panel-inverse">
                    <div class="panel-heading">
                        <div class="panel-heading-btn">
                                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                        </div>                          
                        <h4 class="panel-title"><b>Child List</b></h4>
                    </div>
                    <div class="panel-body">                
                        

                    {% if resultsets %}
                    <div  class="panel panel-inverse">
                        <div class="table-responsive">
                        <!--<table id="data-table" class="table table-striped table-bordered">-->
                        <table id="data-table" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>First Name</th>
                                        <th>Surname</th>
                                        <th>Sex</th>  
                                        <th>OrgUnit</th>
                                        <th>Residence</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                {% for resultset in resultsets %}
                                    {% for result in resultset %}
                                    <tr>                                        
                                        <td>{{ result.id }}</a></td>
                                        <td>{{ result.first_name }}</td>
                                        <td>{{ result.surname }}</td>
                                        <td>{{ result.sex_id|gen_value:vals }}</td>
                                        <td>No OrgUnit Info</td>
                                        <td>No Residence Info</td>
                                        <!--
                                        {% for pgeoloc in result.pgeolocs %}
                                            <td>{{ pgeoloc.area_name }}</td>
                                        {% endfor %}
                                        -->
                                     
                                        <td>
                                        <!-- #modal-dialog -->
                                          <div class="modal fade" id="form-chooser-dialog-{{ result.id }}">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                            <h4 class="modal-title">Choose Form</h4>
                                                        </div>
                                                        <div class="modal-body">
                                                            Please choose a form to fill for  <b>{{ result.first_name }} {{ result.surname }}.</b>

                                                            <br><br>
                                                            {{ form.form_type_search }}
                                                            
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button class="btn btn-sm btn-white" data-dismiss="modal">Cancel</button>
                                                            <button class="btn  btn-sm btn-primary m-r-5" onClick="open_form({{result.id}})" >Ok</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <!-- #modal-dialog -->

                                        <a href="#form-chooser-dialog-{{ result.id }}" class="btn  btn-sm btn-primary m-r-5" data-toggle="modal">
                                        <b>Choose Form</b>&nbsp&nbsp<i class="fa fa-file"></i></a>
                                        </td>
                                    </tr>                              
                                    {% endfor %}
                                {% endfor %}  
                                </tbody>
                            </table>
                        </div>
                    <!--</div>-->
                </div>
                <!-- end panel -->
                {% else %}
                    <div class="norecords" align="center"><b>No records found.</b></div>
                {% endif %}

                    </div>
                 </div>
            </div>
        </div>
        <!-- End OVC Results Row -->
  </div>
</div>
<!-- End Search Row -->



<!-- End content area -->
{% endblock %}

{% block lazy_javascript_code %}
<script src="{% static 'plugins/parsley/dist/parsley.js' %}"></script>
<script src="{% static 'js/bootstrap-table.min.js' %}"></script>
<script src="{% static 'js/bootstrap-table-locale-all.min.js' %}"></script>
<script>
function open_form(id)
{
    var form = $("#form_type_search").val();
    localStorage.setItem("person_id",id);

    //alert(form);
    if(form == 'FT3h'){ 
        return window.location.href='{% url 'case_record_sheet' id=0 %}'.replace("0", id);
    } 
    else{
        alert('WARNING: Selected Form is still under Development!!')
    }   
}
</script>
<script>
$(document).ready(function() 
{
    $('#data-table').bootstrapTable(
    { 
        toggle: 'table', 
        search: 'true',
        locale: 'en-US',
        pagination: 'true',
        pageNumber: 1,
        pageSize: 10,
        //showRefresh: true,
        showToggle: true,
        //showColumns: true,
        singleSelect: true,
        clickToSelect:true,
        maintainSelected: true,


        
        onClickRow: function (row, $element)
        {
            // row: the record corresponding to the clicked row, 
            // $element: the tr element
           
            person_id = row[0];
            person_fname = row[1];
            person_sname = row[2];
            localStorage.setItem("person_id",person_id);
            localStorage.setItem("person_fname",person_fname);
            localStorage.setItem("person_sname",person_sname);
        }
        
    });
});
</script>
<!--<script src="{% static 'js/apps.js' %}"></script>-->
{% endblock %}
